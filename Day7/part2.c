#include <stdio.h>
#include <stdlib.h>


char	**ft_split(char const *s, char c);


/* FUnciona, pero es muy costoso (importar ray_casting de part1.c)
void trail_running(char **map, long *total, int row, int col)
{

	while (row > 0)
	{
		// caso |||
		//		^|^
		if (map[row][col-1] == '^' && map[row][col+1] == '^' && map[row - 1][col] == '|' && map[row-1][col-1] == '|' && map[row-1][col+1] == '|')
		{
			*total += 2;
			trail_running(map, total, row, col - 1);
			trail_running(map, total, row, col + 1);
			trail_running(map, total, row - 1, col);
			return ;
		}
		
		// caso | |
		//		^|^
		else if (map[row][col-1] == '^' && map[row][col+1] == '^' && map[row-1][col-1] == '|' && map[row-1][col+1] == '|')
		{
			*total += 1;
			trail_running(map, total, row, col - 1);
			trail_running(map, total, row, col + 1);
			return ;
		}
		
		// caso  ||
		//		 |^
		else if (map[row - 1][col] == '|' && map[row][col+1] == '^' && map[row-1][col+1] == '|')
		{
			*total += 1;
			trail_running(map, total, row - 1, col);
			trail_running(map, total, row, col + 1);
			return ;
		}
		
		// caso ||
		//		^|
		else if (map[row - 1][col] == '|' && map[row][col-1] == '^' && map[row-1][col-1] == '|')
		{
			*total += 1;
			trail_running(map, total, row - 1, col);
			trail_running(map, total, row, col - 1);
			return ;
		}
		
		// caso   |
		//		 |^
		else if (map[row][col+1] == '^' && map[row-1][col+1] == '|')
		{
			trail_running(map, total, row, col + 1);
			return ;
		}
		
		// caso |
		//		^|
		else if (map[row][col-1] == '^' && map[row-1][col-1] == '|')
		{
			trail_running(map, total, row, col - 1);
			return ;
		}

		// caso  |
		//		 |		
		else if (map[row - 1][col] == '|')
		{
			trail_running(map, total, row - 1, col);
			return ;
		}
		return ;
	}
}*/

void trail_counter(char **map, long **trail_map, int row_max, int col_max)
{
	int row = 0;
	int col = 0;
	
	while (row < row_max - 1)
	{
		col = 0;
		while (col < col_max)
		{
			if (trail_map[row][col] != 0 && map[row+1][col] != '^') //si no hay splitter, bajar numero
				trail_map[row+1][col] += trail_map[row][col];
			else if (trail_map[row][col] != 0 && map[row+1][col] == '^')
			{
				trail_map[row+1][col-1] += trail_map[row][col];
				trail_map[row+1][col+1] += trail_map[row][col];
			}
			col++;
		}
		row++;
	}
}

int main()
{

	//char *input = ".......S.......;...............;.......^.......;...............;......^.^......;...............;.....^.^.^.....;...............;....^.^...^....;...............;...^.^...^.^...;...............;..^...^.....^..;...............;.^.^.^.^.^...^.;...............";
	
	
	char *input = "......................................................................S......................................................................;.............................................................................................................................................;......................................................................^......................................................................;.............................................................................................................................................;.....................................................................^.^.....................................................................;.............................................................................................................................................;....................................................................^...^....................................................................;.............................................................................................................................................;...................................................................^.^.^.^...................................................................;.............................................................................................................................................;..................................................................^.^...^.^..................................................................;.............................................................................................................................................;.................................................................^.^...^...^.................................................................;.............................................................................................................................................;................................................................^.^...^.^...^................................................................;.............................................................................................................................................;...............................................................^...^.^.^.^...^...............................................................;.............................................................................................................................................;..............................................................^.^.....^.....^.^..............................................................;.............................................................................................................................................;.............................................................^.....^...^.^...^.^.............................................................;.............................................................................................................................................;............................................................^.^.^.^.^.^.......^.^............................................................;.............................................................................................................................................;...........................................................^...^.....^.......^.^.^...........................................................;.............................................................................................................................................;..........................................................^.^...^...^...^...^.^.^.^..........................................................;.............................................................................................................................................;.........................................................^.^...^.^.^.^...^.......^.^.........................................................;.............................................................................................................................................;........................................................^.^.^.^.^.^.....^...^.^.^...^........................................................;.............................................................................................................................................;.......................................................^.^.^.^...^...^.^.......^.^.^.^.......................................................;.............................................................................................................................................;......................................................^.....^...^.^...^.^...^...^.^...^......................................................;.............................................................................................................................................;.....................................................^.^.^.............^.^.^.^.^.^.....^.....................................................;.............................................................................................................................................;....................................................^.^.^.^.^.^.^.^...^.......^.^.^.^...^....................................................;.............................................................................................................................................;...................................................^.^.^.^.^...^.^.^...^...^.....^.^.^...^...................................................;.............................................................................................................................................;..................................................^.^.^.....^.........^.^.^.^...^.....^.^.^..................................................;.............................................................................................................................................;.................................................^...^.....^.......^.^.^.^...^.^.^.^.^.^.^.^.................................................;.............................................................................................................................................;................................................^.^.^...^.......^.^.^.^.......^...^.^.^.^...^................................................;.............................................................................................................................................;...............................................^.^.^...........^.^.^.^.^...^.^.....^...^.....^...............................................;.............................................................................................................................................;..............................................^.^.....^.^.^.^...^.^...^.^.^.^.^.^.^.^.......^.^..............................................;.............................................................................................................................................;.............................................^.^.....^.^.^...^.^...^.^...^.^.....^.^...^.^...^.^.............................................;.............................................................................................................................................;............................................^.^.....^.^.^.^.^...^.^.^.^.^.^.....^...^.^...^...^.^............................................;.............................................................................................................................................;...........................................^.^.^.^...^.^.....^...^...^.^.^.^.^.^.........^...^.^.^...........................................;.............................................................................................................................................;..........................................^.^...^.^.^...^.^.^.^...^.^...^.^.^...^...^...^.^.^.^.^.^..........................................;.............................................................................................................................................;.........................................^.^.^.^...^.^...^.^.^.....^.^.....^.^.^...^.....^.^.^...^.^.........................................;.............................................................................................................................................;........................................^.^.....^.^.^...^...^.^.^...^.^.^.^.^...^.^.^.^.....^.^.^.^.^........................................;.............................................................................................................................................;.......................................^...^.^.........^.^.....^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.......................................;.............................................................................................................................................;......................................^.^...^.^...^.....^...^.^.^.^.....^.^.^...^.^.^.^.^.....^.^.....^......................................;.............................................................................................................................................;.....................................^.^.^...^.^.^.^.^...^.^.^...^...^.^.^...^.^.^.^...^...^.^.^...^...^.....................................;.............................................................................................................................................;....................................^.^.^...^.^.............^...^.^.^...^...^.^...^.^.^...^.^.^...^.^.^.^....................................;.............................................................................................................................................;...................................^.^.^...^...^.....^.......^.....^.^.^.^...^...^.^...^.^.^.^.^.....^...^...................................;.............................................................................................................................................;..................................^.^...^...^.^.^...^...^.^.....^.^.^...^.........^.....^...^.^.^.^...^...^..................................;.............................................................................................................................................;.................................^.^.^.......^.^.^.......^.^...^.^.^...^...^.^.....^.^.^.^.^.^...^.^.^.^.^.^.................................;.............................................................................................................................................;................................^.^.^...^.^.......^...^.^.^.....^.^.^.^.....^.^.^.^...^.^.^...^.^.^...^...^.^................................;.............................................................................................................................................;...............................^.^...^.......^.^.^.^.^.^.^.^.......^.^.^.............^.^.^...^.^.^.^...^...^.^...............................;.............................................................................................................................................;..............................^.^.^...^.^.^...^.^.....^.....^.^.^.^.^.^.^.....^.^.^...^.^...^...^.^.^.^.^.^.^.^..............................;.............................................................................................................................................;.............................^.^.^.^.^.^.^...^.^.^.^...^.^.^.^...^.^.^.^.^.........^...^.......^.^...^.^.^.^.^.^.............................;.............................................................................................................................................;............................^...^.^.....^.^.^.........^.^.^.....^.^...^.^.^.....^.^.^.^...^.^.^.^.^.^.^.........^............................;.............................................................................................................................................;...........................^...^...^.......^...^.^.....^...^.^.^.^...^.^...^.^.^.^...^...^.^.........^...^...^...^...........................;.............................................................................................................................................;..........................^.^.^.^.^.....^.^.^.^.....^.....^...^.^...^...^.^.^.^...^.^.......^.^.^.^...^...^.^.^.^.^..........................;.............................................................................................................................................;.........................^.^.^.^...^.^.^.......^.^.....^.^...^...^.^.^.^...^...^...^...^.....^.^.^.^...^.^.^...^.^.^.........................;.............................................................................................................................................;........................^.^...^.^.....^.^.^...........^.^.^...^.^...^.......^.......^...^.^.^.^...^.^.^.^.^.^.^.^.^.^........................;.............................................................................................................................................;.......................^...........^...^.^.........^.^.^.........^...^.....^.^...^.^.^.^.^.^...^.^.^.^...^...^.^.....^.......................;.............................................................................................................................................;......................^.^.^...^.^...^...^.^.........^...^.^.^.^.^...^.^.^.^.^...^.^.^.........^.^...^.^.^.^.....^.^...^......................;.............................................................................................................................................;.....................^...^.^.^.^.^.^...^.^...^.....^...^.^...^.^...^.....^.^.^.^.^.^.^.....^.^.^...^.^...^.^.^.^...^.^.^.....................;.............................................................................................................................................;....................^.^...^...^.^...^.^.^.....^...^.^.^...^.^.^.^.^.....^.^.^...^.....^.^.^...^.^.^.^.^.^.^.^.^.^.......^....................;.............................................................................................................................................;...................^.^...^.^.^...^.^...^.^.^.^...^.^.^.....^.^.^...^.^.......^.^...^.^...^.^...^.^...^...^.....^.....^.^.^...................;.............................................................................................................................................;..................^.^.^.^...^...^...^.^...^.^...^.^.^.....^...^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^.^.^.^...^.^.^.^..................;.............................................................................................................................................;.................^.^.^.^.^.^.^...^.^.^.^.............^.^...^...^.^...^.........^.....^.^...^.....^.^...^.....^...^...^.^.^.^.................;.............................................................................................................................................;................^...^.^.^.^.^.^.^...^...^.^.^.^.^...^.^.^.^...^.......^.^.^.^.^.....^.^.^.^.^.^...^.....^...^.^...^.^.^.^...^................;.............................................................................................................................................;...............^.^.^.^.^...^.^.^.^.^...^.......^.^.^...^.^...^.^.......^.^.....^.^.^...^...^.^...^.....^.^...^.^.^.^.^.^.^.^.^...............;.............................................................................................................................................;..............^.^.^.^.^.....^.^.......^.^.^.^...^.^...^...^.^.^.^.^.^.^.....^.^.^.^.^.^.......^.^.^.^.^...^.^...^.....^...^.^.^..............;.............................................................................................................................................;.............^.^.^.....^.^.^.^...^...^.^.......^.^...^.^.......^.^.....^.^...^.^.^.^.^.^.....^.^.^.^.......^.^.^.^.....^.^.^.^.^.............;.............................................................................................................................................;............^.^...^.^.....^.^.^.^...^.^.^.^.....^.^.^.^.......^...^.^...^.^.^.^...^.^.^.^.^.^.^...^.^.^...^.^...^.^.^.^.^.....^.^............;.............................................................................................................................................;...........^.^.^.^.^.^...^.^.....^...^.^.^.^.^...^...^.^.^.^.^.^.^.....^.^.^.......^.^.^.^.^...^.^.^.^.....^.^.^.^.^.^.....^.^.^.^...........;.............................................................................................................................................;..........^...^.^.^...^.^.^.^.^.^.^.^.^.....^.^...^.^.^.^...^.^.^...^.............^.^.......^.^.^.^...^...^.^.^...^.^...^.^.......^..........;.............................................................................................................................................;.........^.^.^.^.^.^.^...^.^.^...^...^...^.^.^.^.....^...^.^...^.^.....^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^...^.^.^.^...^.....^.....^.........;.............................................................................................................................................;........^.^.^...^.....^.^...^...^.....^.....^.^.^...^.^.^...^...^...^.^...^.^...^...^.....^.^.^.^...^.......^...^.....^.^.^...^.^...^........;.............................................................................................................................................;.......^.......^...^.....^.^...^.^.^.^.^.^.^.............^.^.^...^...^.^.^.^.^.^.^.......^.....^.^.^.^.^.^.^.....^.^.^.^.^.^.^...^...^.......;.............................................................................................................................................;......^.^.^.^.^.^...^.^.^.^...^...^.^.^.^.^.......^.....^.^...^...^.^.....^...^.^.^.^...^.^.^...^.^.^.^.^.....^.....^.......^.......^.^......;.............................................................................................................................................;.....^...^.^.^.^.^...^.....^.^.....^.^.......^.^.^...^.^.^.^...^.^.^...^.^.^...^.^.^...^.^.^.............^.....^.^.^.^.^.^.......^.^.^.^.....;.............................................................................................................................................;....^.......^.^...^.^...^...^.^.^.^.^.^.^...^.^.^.^...^.^.....^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.......^...........^.....^...^.^.^.^.^....;.............................................................................................................................................;...^.^.^.^.....^...^.^.....^.........^.^.^...^...^.^.^...^.^.^.^.^.^...^.......^.^.....^...^...^.^.^.^.^.^.^...^...^.^...^.^.^.^.........^...;.............................................................................................................................................;..^.^.^...^.....^.....^.^...^.^.^.^.^.^.^.^.^...^...^...^.^.^.^...^.^.^...^.^.^.^.^...^...^.^.^.^...^...^.^.....^.^.....^...^...^.^.......^..;.............................................................................................................................................;.^.^.^.^.^.^...^.^.^...^...^.....^...^.^.^.....^.....^.^.^.^.......^.^...^.^...^.^.^.^...^.^...^.^...^.^.^.....^.^.^.^.^...^.^.......^.^.^.^.;.............................................................................................................................................";
	
	
	
	
	char **map = ft_split(input, ';');
	
	
	int i = 0;
	long total = 0;
	while (map[0][i] != 'S') //pilla la posion inicial
		i++;
	int h = 0 ;
	while (map[h] != 0) //altura
		h++;
	int w = 0;
	while (map[h-1][w] != '\0') //ancho
		w++;
	
	
	long **trail_map;
	
	trail_map = malloc(h * sizeof(long *));
	int a = 0;
	while (a < h)
	{
		trail_map[a] = malloc(w * sizeof(long));
		a++;
	}

	//incializando	
	a = 0;
	int b = 0;
	
	while (a < h)
	{
		b = 0;
		while (b < w)
		{
			trail_map[a][b] = 0;
			//printf("%ld ", trail_map[a][b]);
			b++;
		}
		//printf("\n");
		a++;
	}
	trail_map[0][i] = 1;
	trail_counter(map, trail_map, h, w);
	a = 0;
	
	while (a < w)
	{
		total+=trail_map[h-1][a];
		a++;
	}
	
	printf("total splitted times: %ld\n", total);

}




















